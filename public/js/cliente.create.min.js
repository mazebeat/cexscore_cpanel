function adjustIframeHeight(){var a=$("body");var b=a.data("iframe.fv");if(b){b.height(a.height())}}function validateTab(b){var a=$("#createClientForm");var d=a.data("formValidation");var c=a.find(".tab-pane").eq(b);d.validateContainer(c);var e=d.isValidContainer(c);if(e===false||e===null){return false}return true}(function(b){b("textarea").ckeditor().editor.on("change",function(c){});b("#rut_cliente").rut({formatOn:"change keyup",validateOn:"change keyup"});b('input[type="checkbox"], input[type="radio"]').iCheck({tap:true,checkboxClass:"icheckbox_square-orange",radioClass:"iradio_square-orange",increaseArea:"20%"}).on("ifChanged",function(d){d.preventDefault();var c=b(this).attr("name");b("#createClientForm").formValidation("revalidateField",c)}).end();b("#myTabs a").click(function(c){c.preventDefault();b(this).tab("show")});var a={"cliente[rut_cliente]":{validators:{notEmpty:{message:"El RUT es requerido",},callback:{callback:function(d,c){return b.validateRut(d)},message:"El campo RUT es incorrecto"},stringLength:{min:8,max:12,}}},"cliente[fono_cliente]":{validators:{notEmpty:{},regexp:{message:"El número de teléfono solo puede contener dígitos, espacios, -, (, ), + y .",regexp:/^[0-9\s\-()+\.]+$/}}},"usuario[rut_usuario]":{validators:{notEmpty:{message:"El RUT es requerido",},callback:{callback:function(d,c){return b.validateRut(d)},message:"El campo RUT es incorrecto"},stringLength:{min:8,max:12}}},"apariencia[logo_header]":{message:"El archivo no es valido.",validators:{file:{extension:"jpeg,png",type:"image/jpeg,image/png,image/gif",maxSize:2097152,message:"Seleccione un archivo valido."}}},"apariencia[logo_incentivo]":{message:"El archivo no es valido.",validators:{file:{extension:"jpeg,png",type:"image/jpeg,image/png,image/gif",maxSize:2097152,message:"Seleccione un archivo valido."}}}};b("#createClientForm").find("#fieldPais").change(function(e){var d=b("#fieldRegion");var f=b("#fieldCiudad");d.empty().formValidation("revalidateField","cliente[region").show();f.empty().formValidation("revalidateField","cliente[id_ciudad");var c=b(this).find("option:selected").text();if(c=="Chile"||c=="chile"||c=="CHILE"){b(".fieldRegion").show();b(".fieldCiudad").show();d.removeAttr("disabled","disabled");f.removeAttr("disabled","disabled")}else{b(".fieldRegion").hide();b(".fieldCiudad").hide();d.attr("disabled","disabled");f.attr("disabled","disabled")}b.get("/admin/find/locate",{filterBy:"pais",option:b(this).val()},function(h){if(Object.keys(h).length>0){d.append(b("<option value=''></option>"));b.each(h,function(i,j){d.append(b("<option value='"+i+"'>"+j+"</option>"))})}});var g=b(this).attr("name");b("#createClientForm").formValidation("revalidateField",g);e.preventDefault()}).end().find("#fieldRegion").change(function(d){var c=b("#fieldCiudad");c.attr("disabled","disabled").empty().formValidation("revalidateField",c.attr("name")).show();b.get("/admin/find/locate",{filterBy:"region",option:b(this).val()},function(e){if(Object.keys(e).length>0){c.append(b("<option value=''></option>"));b.each(e,function(g,h){c.append(b("<option value='"+g+"'>"+h+"</option>"))})}c.removeAttr("disabled","disabled")});var f=b(this).attr("name");b("#createClientForm").formValidation("revalidateField",f);d.preventDefault()}).end().find('[name="cliente[id_plan]"]').on("ifChecked",function(d){var c=b(this);b("#cant_moment_plan").val(0).removeAttr("disabled");b(".cloneMoment").remove();b.get("/admin/find/configplan",{idplan:c.val()},function(e){var f=parseInt(e);if(f==0||f=="undefined"){f=999}var g=b("#cant_moment_plan").attr("name");b("#cant_moment_plan").attr("max",f).attr("data-fv-lessthan-value",f).end();b("#createClientForm").formValidation("removeField","cant_moment_plan").formValidation("addField","cant_moment_plan").formValidation("revalidateField",g)});d.preventDefault()}).end().find("#addMoments").click(function(i){var j=parseInt(b("#cant_moment_plan").val(),10);var f=1;b(".cloneMoment").remove();for(var c=0;c<j;c++){var d=b("#optionTemplate");var g=d.clone().removeClass("hide").addClass("cloneMoment").removeAttr("id").find(".control-label").text("Momento "+f++).end().insertBefore(d).end();var h=g.find('input[name="momento"]');g.find('[name="momento"]').attr("data-fv-notempty","true").attr("id","momento"+c).attr("required","required").attr("name","momento_encuesta["+c+"][descripcion_momento]").end().find('[name="canal"]').attr("id","canal"+c).attr("required","required").attr("name","momento_encuesta["+c+"][canal]").end();b("#createClientForm").formValidation("addField",h)}i.preventDefault()}).end().find("#id_sector").on("change",function(c){b.get("/admin/find/survey",{id_sector:b(this).val()},function(e){var d=0,f="";b('[name="cliente[id_encuesta]"]').val(e.id);b("#createClientForm").formValidation("revalidateField",b('[name="cliente[id_encuesta]"]'));b.each(e.preguntas,function(g,h){if(h.id_pregunta_padre==null){f="preguntaCabecera["+d+"][descripcion_1]"}else{f="preguntaCabecera["+d+"][sub][descripcion_1]";d++}CKEDITOR.instances[f].setData(h.descripcion_1)})});c.preventDefault()}).end().formValidation({framework:"bootstrap",excluded:[":disabled"],live:"enabled",locale:"es_CL",button:{},fields:a}).on("err.field.fv",function(g,f){var d=f.element.parents(".tab-pane");var c=d.attr("id");b('a[href="#'+c+'"][data-toggle="tab"]').parent().addClass("error").end().find("i").removeClass("fa-check").addClass("fa-times").end();if(f.field=="cant_moment_plan"){b("#addMoments").attr("disabled","disabled")}}).on("success.field.fv",function(j,i){var d=i.element.parents(".tab-pane");var g=d.attr("id");var c=i.fv.isValidContainer(d);var f=b('a[href="#'+g+'"][data-toggle="tab"]').parent().find("i");f.parent().find("i").removeClass("fa-times").addClass("fa-check");console.log(c);if(c!==null){var h="";if(c){$add="fa-check";$rem="fa-times";f.parent().parent().removeClass("error")}else{$add="fa-times";$rem="fa-check";f.parent().parent().addClass("error")}f.addClass($add).removeClass($rem)}if(i.field=="cant_moment_plan"){b("#addMoments").removeAttr("disabled")}if(i.fv.getInvalidFields().length>0){i.fv.disableSubmitButtons(true)}}).on("success.form.fv",function(c){}).bootstrapWizard({tabClass:"nav nav-pills",onTabClick:function(e,c,d){return validateTab(d)},onNext:function(g,d,e){adjustIframeHeight();var f=b("#createClientForm").find(".tab-pane").length;var c=validateTab(e-1);if(!c){return false}if(e===f){}g.removeClass("success-tab").removeClass("error");return true},onPrevious:function(f,d,e){var c=validateTab(e+1);if(!c){f.removeClass("success-tab").addClass("error");return false}f.addClass("success-tab");return true},onLast:function(f,d,e){var c=validateTab(e);if(!c){return false}b("#createClientForm").formValidation("defaultSubmit");return true},onTabShow:function(h,c,f){var e=c.find("li").length;var g=f+1;var d=(g/e)*100;if(g>=e){b("#rootwizard").find(".pager .next").hide().end().find(".pager .finish").css("display","inline").end().find(".pager .finish").removeClass("disabled").end()}else{b("#rootwizard").find(".pager .next").show().end().find(".pager .finish").hide().end()}}})})(jQuery);