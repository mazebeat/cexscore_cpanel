(function(c){function d(){var e=c("body");var f=e.data("iframe.fv");if(f){f.height(e.height())}}function b(f){var e=c("#createClientForm");var h=e.data("formValidation");var g=e.find(".tab-pane").eq(f);h.validateContainer(g);var i=h.isValidContainer(g);if(i===false||i===null){return false}return true}c("textarea").ckeditor().editor.on("change",function(f){});c("#rut_cliente").rut({formatOn:"change keyup",validateOn:"change keyup"});c('input[type="checkbox"], input[type="radio"]').iCheck({tap:true,checkboxClass:"icheckbox_square-orange",radioClass:"iradio_square-orange",increaseArea:"20%"}).on("ifChanged",function(g){g.preventDefault();var f=c(this).attr("name");c("#createClientForm").formValidation("revalidateField",f)}).end();c("#myTabs a").click(function(f){f.preventDefault();c(this).tab("show")});var a={"cliente[rut_cliente]":{validators:{notEmpty:{message:"El RUT es requerido",},callback:{callback:function(f,e){return c.validateRut(f)},message:"El campo RUT es incorrecto"},stringLength:{min:8,max:12,}}},"cliente[fono_cliente]":{validators:{notEmpty:{},regexp:{message:"El número de teléfono solo puede contener dígitos, espacios, -, (, ), + y .",regexp:/^[0-9\s\-()+\.]+$/}}},"usuario[rut_usuario]":{validators:{notEmpty:{message:"El RUT es requerido",},callback:{callback:function(f,e){return c.validateRut(f)},message:"El campo RUT es incorrecto"},stringLength:{min:8,max:12}}},"apariencia[logo_header]":{message:"El archivo no es valido.",validators:{notEmpty:{message:"El archivo es requerido",},file:{extension:"jpeg,png",type:"image/jpeg,image/png,image/gif",maxSize:2097152,message:"Seleccione un archivo valido."}}},"apariencia[logo_incentivo]":{message:"El archivo no es valido.",validators:{notEmpty:{message:"El archivo es requerido",},file:{extension:"jpeg,png",type:"image/jpeg,image/png,image/gif",maxSize:2097152,message:"Seleccione un archivo valido."}}}};c("#createClientForm").find("#fieldPais").change(function(g){var f=c("#fieldRegion");var h=c("#fieldCiudad");f.empty().formValidation("revalidateField","cliente[region").show();h.empty().formValidation("revalidateField","cliente[id_ciudad");var e=c(this).find("option:selected").text();if(e=="Chile"||e=="chile"||e=="CHILE"){c(".fieldRegion").show();c(".fieldCiudad").show();f.removeAttr("disabled","disabled");h.removeAttr("disabled","disabled")}else{c(".fieldRegion").hide();c(".fieldCiudad").hide();f.attr("disabled","disabled");h.attr("disabled","disabled")}c.get("/admin/find/locate",{filterBy:"pais",option:c(this).val()},function(j){if(Object.keys(j).length>0){f.append(c("<option value=''></option>"));c.each(j,function(k,l){f.append(c("<option value='"+k+"'>"+l+"</option>"))})}});var i=c(this).attr("name");c("#createClientForm").formValidation("revalidateField",i);g.preventDefault()}).end().find("#fieldRegion").change(function(g){var f=c("#fieldCiudad");f.attr("disabled","disabled").empty().formValidation("revalidateField",f.attr("name")).show();c.get("/admin/find/locate",{filterBy:"region",option:c(this).val()},function(e){if(Object.keys(e).length>0){f.append(c("<option value=''></option>"));c.each(e,function(i,j){f.append(c("<option value='"+i+"'>"+j+"</option>"))})}f.removeAttr("disabled","disabled")});var h=c(this).attr("name");c("#createClientForm").formValidation("revalidateField",h);g.preventDefault()}).end().find('[name="cliente[id_plan]"]').on("ifChecked",function(g){var f=c(this);c("#cant_moment_plan").val(0).removeAttr("disabled");c(".cloneMoment").remove();c.get("/admin/find/configplan",{idplan:f.val()},function(e){var h=parseInt(e);if(h==0||h=="undefined"){h=9999}var i=c("#cant_moment_plan").attr("name");c("#cant_moment_plan").attr("max",h).attr("data-fv-lessthan-value",h).end();c("#createClientForm").formValidation("removeField","cant_moment_plan").formValidation("addField","cant_moment_plan").formValidation("revalidateField",i)});g.preventDefault()}).end().find("#addMoments").click(function(k){var l=parseInt(c("#cant_moment_plan").val(),10);var h=1;c(".cloneMoment").remove();for(var f=0;f<l;f++){var g=c("#optionTemplate");var i=g.clone().removeClass("hide").addClass("cloneMoment").removeAttr("id").find(".control-label").text("Momento "+h++).end().insertBefore(g).end();var j=i.find('input[name="momento"]');i.find('[name="momento"]').attr("data-fv-notempty","true").attr("id","momento"+f).attr("required","required").attr("name","momento_encuesta["+f+"][descripcion_momento]").end().find('[name="canal"]').attr("id","canal"+f).attr("required","required").attr("name","momento_encuesta["+f+"][canal]").end();c("#createClientForm").formValidation("addField",j)}k.preventDefault()}).end().find("#id_sector").on("change",function(f){c.get("/admin/find/survey",{id_sector:c(this).val()},function(g){var e=0,h="";c('[name="cliente[id_encuesta]"]').val(g.id);c("#createClientForm").formValidation("revalidateField",c('[name="cliente[id_encuesta]"]'));c.each(g.preguntas,function(i,j){if(j.id_pregunta_padre==null){h="preguntaCabecera["+e+"][descripcion_1]"}else{h="preguntaCabecera["+e+"][sub][descripcion_1]";e++}CKEDITOR.instances[h].setData(j.descripcion_1);c('[name="'+h+'"]').html(j.descripcion_1)})});f.preventDefault()}).end().formValidation({framework:"bootstrap",excluded:[":disabled",":hidden"],live:"enabled",locale:"es_CL",button:{},fields:a}).on("err.field.fv",function(i,h){var g=h.element.parents(".tab-pane");var f=g.attr("id");c('a[href="#'+f+'"][data-toggle="tab"]').parent().addClass("error").end().find("i").removeClass("fa-check").addClass("fa-times").end();if(h.field=="cant_moment_plan"){c("#addMoments").attr("disabled","disabled")}}).on("success.field.fv",function(l,k){var g=k.element.parents(".tab-pane");var i=g.attr("id");var f=k.fv.isValidContainer(g);var h=c('a[href="#'+i+'"][data-toggle="tab"]').parent().find("i");h.parent().find("i").removeClass("fa-times").addClass("fa-check");if(f!==null){var j="";if(f){$add="fa-check";$rem="fa-times";h.parent().parent().removeClass("error")}else{$add="fa-times";$rem="fa-check";h.parent().parent().addClass("error")}h.addClass($add).removeClass($rem)}if(k.field=="cant_moment_plan"){c("#addMoments").removeAttr("disabled")}if(k.fv.getInvalidFields().length>0){k.fv.disableSubmitButtons(true)}}).on("success.form.fv",function(f){}).bootstrapWizard({tabClass:"nav nav-pills",onTabClick:function(g,e,f){return b(f)},onNext:function(i,f,g){d();var h=c("#createClientForm").find(".tab-pane").length;var e=b(g-1);if(!e){return false}if(g===h){}i.removeClass("success-tab").removeClass("error");return true},onPrevious:function(h,f,g){var e=b(g+1);if(!e){h.removeClass("success-tab").addClass("error");return false}h.addClass("success-tab");return true},onLast:function(h,f,g){var e=b(g);if(!e){return false}c("#createClientForm").formValidation("defaultSubmit");return true},onTabShow:function(j,e,h){var g=e.find("li").length;var i=h+1;var f=(i/g)*100;if(i>=g){c("#rootwizard").find(".pager .next").hide().end().find(".pager .finish").css("display","inline").end().find(".pager .finish").removeClass("disabled").end()}else{c("#rootwizard").find(".pager .next").show().end().find(".pager .finish").hide().end()}}})})(jQuery);