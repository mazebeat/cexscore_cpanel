if(!AmCharts.translations["export"]){AmCharts.translations["export"]={}}if(!AmCharts.translations["export"]["en"]){AmCharts.translations["export"]["en"]={"fallback.save.text":"CTRL + C to copy the data into the clipboard.","fallback.save.image":"Rightclick -> Save picture as... to save the image.","capturing.delayed.menu.label":"{{duration}}","capturing.delayed.menu.title":"Click to cancel","menu.label.print":"Print","menu.label.undo":"Undo","menu.label.redo":"Redo","menu.label.cancel":"Cancel","menu.label.save.image":"Download as ...","menu.label.save.data":"Save as ...","menu.label.draw":"Annotate ...","menu.label.draw.change":"Change ...","menu.label.draw.add":"Add ...","menu.label.draw.shapes":"Shape ...","menu.label.draw.colors":"Color ...","menu.label.draw.widths":"Size ...","menu.label.draw.opacities":"Opacity ...","menu.label.draw.text":"Text","menu.label.draw.modes":"Mode ...","menu.label.draw.modes.pencil":"Pencil","menu.label.draw.modes.line":"Line","menu.label.draw.modes.arrow":"Arrow"}}(function(){AmCharts["export"]=function(d,e){var f={name:"export",version:"1.4.8",libs:{async:true,autoLoad:true,reload:false,resources:[{"pdfmake/pdfmake.js":["pdfmake/vfs_fonts.js"],"jszip/jszip.js":["xlsx/xlsx.js"]},"fabric.js/fabric.js","FileSaver.js/FileSaver.js"],namespaces:{"pdfmake.js":"pdfMake","jszip.js":"JSZip","xlsx.js":"XLSX","fabric.js":"fabric","FileSaver.js":"saveAs"}},config:{},setup:{chart:d,hasBlob:false,wrapper:false},drawing:{enabled:false,undos:[],redos:[],buffer:{position:{x1:0,y1:0,x2:0,y2:0,xD:0,yD:0}},handler:{undo:function(c,h){var b=f.drawing.undos.pop();if(b){b.selectable=true;f.drawing.redos.push(b);if(b.action=="added"){f.setup.fabric.remove(b.target)}var a=JSON.parse(b.state);b.target.set(a);if(b.target instanceof fabric.Group){f.drawing.handler.change({color:a.cfg.color,width:a.cfg.width,opacity:a.cfg.opacity},true,b.target)}f.setup.fabric.renderAll();if(b.state==b.target.recentState&&!h){f.drawing.handler.undo(b,true)}}},redo:function(c,h){var b=f.drawing.redos.pop();if(b){b.selectable=true;f.drawing.undos.push(b);if(b.action=="added"){f.setup.fabric.add(b.target)}var a=JSON.parse(b.state);b.target.recentState=b.state;b.target.set(a);if(b.target instanceof fabric.Group){f.drawing.handler.change({color:a.cfg.color,width:a.cfg.width,opacity:a.cfg.opacity},true,b.target)}f.setup.fabric.renderAll();if(b.action=="addified"){f.drawing.handler.redo()}}},done:function(a){f.drawing.buffer.enabled=false;f.drawing.undos=[];f.drawing.redos=[];f.createMenu(f.config.menu);f.setup.fabric.deactivateAll();if(f.setup.wrapper){f.setup.chart.containerDiv.removeChild(f.setup.wrapper);f.setup.wrapper=false}},add:function(b){var c=f.deepMerge({top:f.setup.fabric.height/2,left:f.setup.fabric.width/2},b||{});var a=c.url.indexOf(".svg")!=-1?fabric.loadSVGFromURL:fabric.Image.fromURL;a(c.url,function(l,n){var k=n!==undefined?fabric.util.groupSVGElements(l,n):l;var m=false;if(k.height>f.setup.fabric.height||k.width>f.setup.fabric.width){m=(f.setup.fabric.height/2)/k.height}if(c.top>f.setup.fabric.height){c.top=f.setup.fabric.height/2}if(c.left>f.setup.fabric.width){c.left=f.setup.fabric.width/2}k.set({originX:"center",originY:"center",top:c.top,left:c.left,width:m?k.width*m:k.width,height:m?k.height*m:k.height,fill:f.drawing.color});f.setup.fabric.add(k)})},change:function(a,c,n){var o=f.deepMerge({},a||{});var r,q,p;var m=n||f.drawing.buffer.target;var b=m?m._objects?m._objects:[m]:null;if(o.mode){f.drawing.mode=o.mode}if(o.width){f.drawing.width=o.width;f.drawing.fontSize=o.width*3}if(o.fontSize){f.drawing.fontSize=o.fontSize}if(o.color){f.drawing.color=o.color}if(o.opacity){f.drawing.opacity=o.opacity}p=new fabric.Color(f.drawing.color).getSource();p.pop();p.push(f.drawing.opacity);f.drawing.color="rgba("+p.join()+")";f.setup.fabric.freeDrawingBrush.color=f.drawing.color;f.setup.fabric.freeDrawingBrush.width=f.drawing.width;if(m){r=JSON.parse(m.recentState).cfg;if(r){o.color=o.color||r.color;o.width=o.width||r.width;o.opacity=o.opacity||r.opacity;o.fontSize=o.fontSize||o.width*3;p=new fabric.Color(o.color).getSource();p.pop();p.push(o.opacity);o.color="rgba("+p.join()+")"}for(q=0;q<b.length;q++){if(b[q] instanceof fabric.Text||b[q] instanceof fabric.PathGroup||b[q] instanceof fabric.Triangle){if(o.color||o.opacity){b[q].set({fill:o.color})}if(o.fontSize){b[q].set({fontSize:o.fontSize})}}else{if(b[q] instanceof fabric.Path||b[q] instanceof fabric.Line){if(m instanceof fabric.Group){if(o.color||o.opacity){b[q].set({stroke:o.color})}}else{if(o.color||o.opacity){b[q].set({stroke:o.color})}if(o.width){b[q].set({strokeWidth:o.width})}}}}}if(!c){r=JSON.stringify(f.deepMerge(m.saveState().originalState,{cfg:{color:o.color,width:o.width,opacity:o.opacity}}));m.recentState=r;f.drawing.redos=[];f.drawing.undos.push({action:"modified",target:m,state:r})}f.setup.fabric.renderAll()}},text:function(b){var c=f.deepMerge({text:f.i18l("menu.label.draw.text"),top:f.setup.fabric.height/2,left:f.setup.fabric.width/2,fontSize:f.drawing.fontSize,fontFamily:f.setup.chart.fontFamily||"Verdana",fill:f.drawing.color},b||{});c.click=function(){};var a=new fabric.IText(c.text,c);f.setup.fabric.add(a);f.setup.fabric.setActiveObject(a);a.selectAll();a.enterEditing();return a},line:function(m){var o=f.deepMerge({x1:(f.setup.fabric.width/2)-(f.setup.fabric.width/10),x2:(f.setup.fabric.width/2)+(f.setup.fabric.width/10),y1:(f.setup.fabric.height/2),y2:(f.setup.fabric.height/2),angle:90,strokeLineCap:f.drawing.lineCap,arrow:f.drawing.arrow,color:f.drawing.color,width:f.drawing.width,group:[],},m||{});var l,c,n,a;var p=new fabric.Line([o.x1,o.y1,o.x2,o.y2],{stroke:o.color,strokeWidth:o.width,strokeLineCap:o.strokeLineCap});o.group.push(p);if(o.arrow){o.angle=o.angle?o.angle:f.getAngle(o.x1,o.y1,o.x2,o.y2);if(o.arrow=="start"){n=o.y1+(o.width/2);a=o.x1+(o.width/2)}else{if(o.arrow=="middle"){n=o.y2+(o.width/2)-((o.y2-o.y1)/2);a=o.x2+(o.width/2)-((o.x2-o.x1)/2)}else{n=o.y2+(o.width/2);a=o.x2+(o.width/2)}}c=new fabric.Triangle({top:n,left:a,fill:o.color,height:o.width*7,width:o.width*7,angle:o.angle,originX:"center",originY:"bottom"});o.group.push(c)}if(o.action!="config"){if(o.arrow){var b=new fabric.Group(o.group);b.set({cfg:o,fill:o.color,action:o.action,selectable:true,known:o.action=="change"});if(o.action=="change"){f.setup.fabric.setActiveObject(b)}f.setup.fabric.add(b);return b}else{f.setup.fabric.add(p);return p}}else{for(l=0;l<o.group.length;l++){o.group[l].noUndo=true;f.setup.fabric.add(o.group[l])}}return o}}},defaults:{position:"top-right",fileName:"amCharts",action:"download",overflow:true,path:((d.path||"")+"plugins/export/"),formats:{JPG:{mimeType:"image/jpg",extension:"jpg",capture:true},PNG:{mimeType:"image/png",extension:"png",capture:true},SVG:{mimeType:"text/xml",extension:"svg",capture:true},PDF:{mimeType:"application/pdf",extension:"pdf",capture:true},CSV:{mimeType:"text/plain",extension:"csv"},JSON:{mimeType:"text/plain",extension:"json"},XLSX:{mimeType:"application/octet-stream",extension:"xlsx"}},fabric:{backgroundColor:"#FFFFFF",removeImages:true,selection:false,drawing:{enabled:true,arrow:"end",lineCap:"butt",mode:"pencil",modes:["pencil","line","arrow"],color:"#000000",colors:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF"],shapes:["11.svg","14.svg","16.svg","17.svg","20.svg","27.svg"],width:1,fontSize:11,widths:[1,5,10,15],opacity:1,opacities:[1,0.8,0.6,0.4,0.2],menu:undefined,autoClose:true}},pdfMake:{pageSize:"A4",pageOrientation:"portrait",images:{},content:["Saved from:",window.location.href,{image:"reference",fit:[523.28,769.89]}]},menu:undefined,divId:null,menuReviver:null,menuWalker:null,fallback:true,keyListener:true,fileListener:true},i18l:function(c,a){var b=a?langugage:f.setup.chart.language?f.setup.chart.language:"en";var h=AmCharts.translations[f.name][b]||AmCharts.translations[f.name]["en"];return h[c]||c},download:function(c,l,m){if(window.saveAs&&f.setup.hasBlob){var n=f.toBlob({data:c,type:l},function(g){saveAs(g,m)})}else{if(f.config.fallback&&l=="text/plain"){var a=document.createElement("div");var b=document.createElement("div");var p=document.createElement("textarea");b.innerHTML=f.i18l("fallback.save.text");a.appendChild(b);a.appendChild(p);b.setAttribute("class","amcharts-export-fallback-message");a.setAttribute("class","amcharts-export-fallback");f.setup.chart.containerDiv.appendChild(a);p.setAttribute("readonly","");p.value=c;p.focus();p.select();f.createMenu([{"class":"export-main export-close",label:"Done",click:function(){f.createMenu(f.config.menu);f.setup.chart.containerDiv.removeChild(a)}}])}else{if(f.config.fallback&&l.split("/")[0]=="image"){var a=document.createElement("div");var b=document.createElement("div");var o=f.toImage({data:c});b.innerHTML=f.i18l("fallback.save.image");a.appendChild(b);a.appendChild(o);b.setAttribute("class","amcharts-export-fallback-message");a.setAttribute("class","amcharts-export-fallback");f.setup.chart.containerDiv.appendChild(a);f.createMenu([{"class":"export-main export-close",label:"Done",click:function(){f.createMenu(f.config.menu);f.setup.chart.containerDiv.removeChild(a)}}])}else{throw new Error("Unable to create file. Ensure saveAs (FileSaver.js) is supported.")}}}return c},loadResource:function(v,c){var q,p,s,a,t,o;var u=v.indexOf("//")!=-1?v:[f.libs.path,v].join("");function b(){if(c){for(q=0;q<c.length;q++){f.loadResource(c[q])}}}if(v.indexOf(".js")!=-1){s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("src",u);if(f.libs.async){s.setAttribute("async","")}}else{if(v.indexOf(".css")!=-1){s=document.createElement("link");s.setAttribute("type","text/css");s.setAttribute("rel","stylesheet");s.setAttribute("href",u)}}for(q=0;q<document.head.childNodes.length;q++){a=document.head.childNodes[q];t=a?(a.src||a.href):false;o=a?a.tagName:false;if(a&&t&&t.indexOf(v)!=-1){if(f.libs.reload){document.head.removeChild(a)}p=true;break}}for(q in f.libs.namespaces){var r=f.libs.namespaces[q];var t=v.toLowerCase();var a=q.toLowerCase();if(t.indexOf(a)!=-1&&window[r]!==undefined){p=true;break}}if(!p||f.libs.reload){s.addEventListener("load",b);document.head.appendChild(s)}},loadDependencies:function(){var a,b;if(f.libs.autoLoad){for(a=0;a<f.libs.resources.length;a++){if(f.libs.resources[a] instanceof Object){for(b in f.libs.resources[a]){f.loadResource(b,f.libs.resources[a][b])}}else{f.loadResource(f.libs.resources[a])}}}},pxToNumber:function(b,a){if(!b&&a){return undefined}return Number(String(b).replace("px",""))||0},numberToPx:function(a){return String(a)+"px"},deepMerge:function(k,l,c){var a,j,b=l instanceof Array?"array":"object";for(a in l){if(b=="array"&&isNaN(a)){continue}j=l[a];if(k[a]==undefined||c){if(j instanceof Array){k[a]=new Array()}else{if(j instanceof Function){k[a]=new Function()}else{if(j instanceof Date){k[a]=new Date()}else{if(j instanceof Object){k[a]=new Object()}else{if(j instanceof Number){k[a]=new Number()}else{if(j instanceof String){k[a]=new String()}}}}}}}if((k instanceof Object||k instanceof Array)&&(j instanceof Object||j instanceof Array)&&!(j instanceof Function||j instanceof Date||f.isElement(j))&&a!="chart"){f.deepMerge(k[a],j,c)}else{if(k instanceof Array&&!c){k.push(j)}else{k[a]=j}}}return k},isElement:function(a){return a instanceof Object&&a&&a.nodeType===1},isHashbanged:function(b){var a=String(b).replace(/\"/g,"");return a.slice(0,3)=="url"?a.slice(a.indexOf("#")+1,a.length-1):false},isPressed:function(a){if(a.type=="mousemove"&&a.which===1){}else{if(a.type=="touchmove"||a.buttons===1||a.button===1||a.which===1){f.drawing.buffer.isPressed=true}else{f.drawing.buffer.isPressed=false}}return f.drawing.buffer.isPressed},isTainted:function(a){var b=String(window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));if(a&&a.indexOf("//")!=-1&&a.indexOf(b.replace(/.*:/,""))==-1){return true}return false},isSupported:function(){if(!f.config.enabled){return false}if(AmCharts.isIE&&AmCharts.IEversion<=9){if(!Array.prototype.indexOf||!document.head||f.config.fallback===false){return false}}return true},getAngle:function(l,c,m,k){var n=m-l;var a=k-c;var b;if(n==0){if(a==0){b=0}else{if(a>0){b=Math.PI/2}else{b=Math.PI*3/2}}}else{if(a==0){if(n>0){b=0}else{b=Math.PI}}else{if(n<0){b=Math.atan(a/n)+Math.PI}else{if(a<0){b=Math.atan(a/n)+(2*Math.PI)}else{b=Math.atan(a/n)}}}}return b*180/Math.PI},gatherAttribute:function(a,j,i,c){var b,c=c?c:0,i=i?i:3;if(a){b=a.getAttribute(j);if(!b&&c<i){return f.gatherAttribute(a.parentNode,j,i,c+1)}}return b},gatherClassName:function(a,c,j,i){var b,i=i?i:0,j=j?j:3;if(f.isElement(a)){b=(a.getAttribute("class")||"").split(" ").indexOf(c)!=-1;if(!b&&i<j){return f.gatherClassName(a.parentNode,c,j,i+1)}else{if(b){b=a}}}return b},gatherElements:function(b,n,c){var o,p;for(o=0;o<b.children.length;o++){var r=b.children[o];if(r.tagName=="clipPath"){var a={};var q=fabric.parseTransformAttribute(f.gatherAttribute(r,"transform"));for(p=0;p<r.childNodes.length;p++){r.childNodes[p].setAttribute("fill","transparent");a={x:f.pxToNumber(r.childNodes[p].getAttribute("x")),y:f.pxToNumber(r.childNodes[p].getAttribute("y")),width:f.pxToNumber(r.childNodes[p].getAttribute("width")),height:f.pxToNumber(r.childNodes[p].getAttribute("height"))}}b.clippings[r.id]={svg:r,bbox:a,transform:q}}else{if(r.tagName=="pattern"){var m={node:r,source:r.getAttribute("xlink:href"),width:Number(r.getAttribute("width")),height:Number(r.getAttribute("height")),repeat:"repeat"};for(p=0;p<r.childNodes.length;p++){if(r.childNodes[p].tagName=="rect"){m.fill=r.childNodes[p].getAttribute("fill")}}if(n.removeImages&&f.isTainted(m.source)){b.patterns[r.id]=m.fill?m.fill:"transparent"}else{c.included++;b.patterns[m.node.id]=m}}else{if(r.tagName=="image"){c.included++;fabric.Image.fromURL(r.getAttribute("xlink:href"),function(g){c.loaded++})}}}}return b},gatherPosition:function(c,j){var i=f.drawing.buffer.position;var b=fabric.util.invertTransform(f.setup.fabric.viewportTransform);var a;if(c.type=="touchmove"){if("touches" in c){c=c.touches[0]}else{if("changedTouches" in c){c=c.changedTouches[0]}}}a=fabric.util.transformPoint(f.setup.fabric.getPointer(c,true),b);if(j==1){i.x1=a.x;i.y1=a.y}i.x2=a.x;i.y2=a.y;i.xD=(i.x1-i.x2)<0?(i.x1-i.x2)*-1:(i.x1-i.x2);i.yD=(i.y1-i.y2)<0?(i.y1-i.y2)*-1:(i.y1-i.y2);return i},capture:function(a,c){var y;var v=f.deepMerge(f.deepMerge({},f.config.fabric),a||{});var z=[];var x={x:0,y:0,pX:0,pY:0,width:f.setup.chart.divRealWidth,height:f.setup.chart.divRealHeight};var u={loaded:0,included:0};fabric.ElementsParser.prototype.resolveGradient=function(g,h){var j=g.get(h);if(!(/^url\(/).test(j)){return}var i=j.slice(j.indexOf("#")+1,j.length-1);if(fabric.gradientDefs[this.svgUid][i]){g.set(h,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][i],g))}};f.handleCallback(v.beforeCapture,v);var r=f.setup.chart.containerDiv.getElementsByTagName("svg");for(y=0;y<r.length;y++){var q={svg:r[y],parent:r[y].parentNode,children:r[y].getElementsByTagName("*"),offset:{x:0,y:0},patterns:{},clippings:{}};q=f.gatherElements(q,v,u);z.push(q)}if(f.config.legend&&f.setup.chart.legend&&f.setup.chart.legend.position=="outside"){var q={svg:f.setup.chart.legend.container.container,parent:f.setup.chart.legend.container.container.parentNode,children:f.setup.chart.legend.container.container.getElementsByTagName("*"),offset:{x:0,y:0},legend:{type:["top","left"].indexOf(f.config.legend.position)!=-1?"unshift":"push",position:f.config.legend.position,width:f.config.legend.width?f.config.legend.width:f.setup.chart.legend.container.width,height:f.config.legend.height?f.config.legend.height:f.setup.chart.legend.container.height},patterns:{},clippings:{}};if(["left","right"].indexOf(q.legend.position)!=-1){x.width+=q.legend.width;x.height=q.legend.height>x.height?q.legend.height:x.height}else{if(["top","bottom"].indexOf(q.legend.position)!=-1){x.height+=q.legend.height}}q=f.gatherElements(q,v,u);z[q.legend.type](q)}f.drawing.buffer.enabled=v.action=="draw";f.setup.wrapper=document.createElement("div");f.setup.wrapper.setAttribute("class",f.setup.chart.classNamePrefix+"-export-canvas");f.setup.chart.containerDiv.appendChild(f.setup.wrapper);if(f.setup.chart.type=="stock"){var s={top:0,right:0,bottom:0,left:0};if(f.setup.chart.leftContainer){x.width-=f.setup.chart.leftContainer.offsetWidth;s.left=f.setup.chart.leftContainer.offsetWidth+(f.setup.chart.panelsSettings.panelSpacing*2)}if(f.setup.chart.rightContainer){x.width-=f.setup.chart.rightContainer.offsetWidth;s.right=f.setup.chart.rightContainer.offsetWidth+(f.setup.chart.panelsSettings.panelSpacing*2)}if(f.setup.chart.periodSelector&&["top","bottom"].indexOf(f.setup.chart.periodSelector.position)!=-1){x.height-=f.setup.chart.periodSelector.offsetHeight+f.setup.chart.panelsSettings.panelSpacing;s[f.setup.chart.periodSelector.position]+=f.setup.chart.periodSelector.offsetHeight+f.setup.chart.panelsSettings.panelSpacing}if(f.setup.chart.dataSetSelector&&["top","bottom"].indexOf(f.setup.chart.dataSetSelector.position)!=-1){x.height-=f.setup.chart.dataSetSelector.offsetHeight;s[f.setup.chart.dataSetSelector.position]+=f.setup.chart.dataSetSelector.offsetHeight}f.setup.wrapper.style.paddingTop=f.numberToPx(s.top);f.setup.wrapper.style.paddingRight=f.numberToPx(s.right);f.setup.wrapper.style.paddingBottom=f.numberToPx(s.bottom);f.setup.wrapper.style.paddingLeft=f.numberToPx(s.left)}f.setup.canvas=document.createElement("canvas");f.setup.wrapper.appendChild(f.setup.canvas);f.setup.fabric=new fabric.Canvas(f.setup.canvas,f.deepMerge({width:x.width,height:x.height,isDrawingMode:true},v));f.deepMerge(f.setup.fabric,v);f.deepMerge(f.setup.fabric.freeDrawingBrush,v.drawing);f.deepMerge(f.drawing,v.drawing);f.drawing.handler.change(v.drawing);f.setup.fabric.on("mouse:down",function(g){var h=f.gatherPosition(g.e,1);f.drawing.buffer.pressedTS=Number(new Date());f.isPressed(g.e)});f.setup.fabric.on("mouse:move",function(g){var h=f.gatherPosition(g.e,2);f.isPressed(g.e);if(f.drawing.buffer.isPressed&&!f.drawing.buffer.line){if(!f.drawing.buffer.isSelected&&f.drawing.mode!="pencil"&&(h.xD>5||h.xD>5)){f.drawing.buffer.hasLine=true;f.setup.fabric.isDrawingMode=false;f.setup.fabric._onMouseUpInDrawingMode(g);f.drawing.buffer.line=f.drawing.handler.line({x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,arrow:f.drawing.mode=="line"?false:f.drawing.arrow,action:"config"})}}if(f.drawing.buffer.line){var i,j,k;var l=f.drawing.buffer.line;l.x2=h.x2;l.y2=h.y2;for(y=0;y<l.group.length;y++){i=l.group[y];if(i instanceof fabric.Line){i.set({x2:l.x2,y2:l.y2})}else{if(i instanceof fabric.Triangle){l.angle=(f.getAngle(l.x1,l.y1,l.x2,l.y2)+90);if(l.arrow=="start"){j=l.y1+(l.width/2);k=l.x1+(l.width/2)}else{if(l.arrow=="middle"){j=l.y2+(l.width/2)-((l.y2-l.y1)/2);k=l.x2+(l.width/2)-((l.x2-l.x1)/2)}else{j=l.y2+(l.width/2);k=l.x2+(l.width/2)}}i.set({top:j,left:k,angle:l.angle})}}}f.setup.fabric.renderAll()}});f.setup.fabric.on("mouse:up",function(g){if(Number(new Date())-f.drawing.buffer.pressedTS<200){var h=f.setup.fabric.findTarget(g.e);if(h&&h.selectable){f.setup.fabric.setActiveObject(h)}}if(f.drawing.buffer.line){for(y=0;y<f.drawing.buffer.line.group.length;y++){f.drawing.buffer.line.group[y].remove()}delete f.drawing.buffer.line.action;delete f.drawing.buffer.line.group;f.drawing.handler.line(f.drawing.buffer.line)}f.drawing.buffer.line=false;f.drawing.buffer.hasLine=false;f.drawing.buffer.isPressed=false});f.setup.fabric.on("object:selected",function(g){f.drawing.buffer.isSelected=true;f.drawing.buffer.target=g.target;f.setup.fabric.isDrawingMode=false});f.setup.fabric.on("selection:cleared",function(g){f.drawing.buffer.onMouseDown=f.setup.fabric.freeDrawingBrush.onMouseDown;f.drawing.buffer.target=false;if(f.drawing.buffer.isSelected){f.setup.fabric._isCurrentlyDrawing=false;f.setup.fabric.freeDrawingBrush.onMouseDown=function(){}}setTimeout(function(){f.drawing.buffer.isSelected=false;f.setup.fabric.isDrawingMode=true;f.setup.fabric.freeDrawingBrush.onMouseDown=f.drawing.buffer.onMouseDown},10)});f.setup.fabric.on("path:created",function(g){var h=g.path;if(Number(new Date())-f.drawing.buffer.pressedTS<200||f.drawing.buffer.hasLine){f.setup.fabric.remove(h);f.setup.fabric.renderAll();return}});f.setup.fabric.on("object:added",function(g){var i=g.target;var h=f.deepMerge(i.saveState().originalState,{cfg:{color:f.drawing.color,width:f.drawing.width,opacity:f.drawing.opacity,fontSize:f.drawing.fontSize}});if(Number(new Date())-f.drawing.buffer.pressedTS<200&&!i.noUndo){f.setup.fabric.remove(i);f.setup.fabric.renderAll();return}h=JSON.stringify(h);i.recentState=h;if(i.selectable&&!i.known&&!i.noUndo){f.drawing.undos.push({action:"added",target:i,state:h});f.drawing.undos.push({action:"addified",target:i,state:h});f.drawing.redos=[]}i.known=true;f.setup.fabric.isDrawingMode=true});f.setup.fabric.on("object:modified",function(g){var i=g.target;var j=JSON.parse(i.recentState);var h=f.deepMerge(i.saveState().originalState,{cfg:j.cfg});h=JSON.stringify(h);i.recentState=h;f.drawing.undos.push({action:"modified",target:i,state:h});f.drawing.redos=[]});f.setup.fabric.on("text:changed",function(g){var h=g.target;clearTimeout(h.timer);h.timer=setTimeout(function(){var i=JSON.stringify(h.saveState().originalState);h.recentState=i;f.drawing.redos=[];f.drawing.undos.push({action:"modified",target:h,state:i})},250)});if(f.drawing.buffer.enabled){f.setup.wrapper.setAttribute("class",f.setup.chart.classNamePrefix+"-export-canvas active");f.setup.wrapper.style.backgroundColor=v.backgroundColor;f.setup.wrapper.style.display="block"}else{f.setup.wrapper.setAttribute("class",f.setup.chart.classNamePrefix+"-export-canvas");f.setup.wrapper.style.display="none"}for(y=0;y<z.length;y++){var q=z[y];var w=f.gatherClassName(q.parent,f.setup.chart.classNamePrefix+"-legend-div",1);var b=f.gatherClassName(q.parent,f.setup.chart.classNamePrefix+"-stock-panel-div");var t=f.gatherClassName(q.parent,f.setup.chart.classNamePrefix+"-scrollbar-chart-div");if(f.setup.chart.type=="stock"&&f.setup.chart.legendSettings.position){if(["top","bottom"].indexOf(f.setup.chart.legendSettings.position)!=-1){if(q.parent.style.top&&q.parent.style.left){q.offset.y=f.pxToNumber(q.parent.style.top);q.offset.x=f.pxToNumber(q.parent.style.left)}else{q.offset.x=x.x;q.offset.y=x.y;x.y+=f.pxToNumber(q.parent.style.height);if(b){x.pY=f.pxToNumber(b.style.marginTop);q.offset.y+=x.pY}else{if(t){q.offset.y+=x.pY}}}}else{if(["left","right"].indexOf(f.setup.chart.legendSettings.position)!=-1){q.offset.y=f.pxToNumber(q.parent.style.top)+x.pY;q.offset.x=f.pxToNumber(q.parent.style.left)+x.pX;if(w){x.pY+=f.pxToNumber(b.style.height)+f.setup.chart.panelsSettings.panelSpacing}else{if(t){q.offset.y-=f.setup.chart.panelsSettings.panelSpacing}}}}}else{if(q.parent.style.position=="absolute"){q.offset.absolute=true;q.offset.top=f.pxToNumber(q.parent.style.top);q.offset.right=f.pxToNumber(q.parent.style.right,true);q.offset.bottom=f.pxToNumber(q.parent.style.bottom,true);q.offset.left=f.pxToNumber(q.parent.style.left);q.offset.width=f.pxToNumber(q.parent.style.width);q.offset.height=f.pxToNumber(q.parent.style.height)}else{if(q.parent.style.top&&q.parent.style.left){q.offset.y=f.pxToNumber(q.parent.style.top);q.offset.x=f.pxToNumber(q.parent.style.left)}else{if(q.legend){if(q.legend.position=="left"){x.x+=q.legend.width}else{if(q.legend.position=="right"){q.offset.x+=x.width-q.legend.width}else{if(q.legend.position=="top"){x.y+=q.legend.height}else{if(q.legend.position=="bottom"){q.offset.y+=x.height-q.legend.height}}}}}else{q.offset.x=x.x;q.offset.y=x.y+x.pY;x.y+=f.pxToNumber(q.parent.style.height)}}}if(w&&b&&b.style.marginTop){x.y+=f.pxToNumber(b.style.marginTop);q.offset.y+=f.pxToNumber(b.style.marginTop)}}fabric.parseSVGDocument(q.svg,(function(g){return function(R,N){var O;var l=fabric.util.groupSVGElements(R,N);var S=[];var h={selectable:false};if(g.offset.absolute){if(g.offset.bottom!==undefined){h.top=x.height-g.offset.height-g.offset.bottom}else{h.top=g.offset.top}if(g.offset.right!==undefined){h.left=x.width-g.offset.width-g.offset.right}else{h.left=g.offset.left}}else{h.top=g.offset.y;h.left=g.offset.x}for(O=0;O<l.paths.length;O++){var U=null;if(l.paths[O]){if(v.removeImages&&f.isTainted(l.paths[O]["xlink:href"])){continue}if(l.paths[O].fill instanceof Object){if(l.paths[O].fill.type=="radial"){l.paths[O].fill.coords.r2=l.paths[O].fill.coords.r1*-1;l.paths[O].fill.coords.r1=0}l.paths[O].set({opacity:l.paths[O].fillOpacity})}else{if(U=f.isHashbanged(l.paths[O].fill)){if(g.patterns&&g.patterns[U]){var P=g.patterns[U];fabric.Image.fromURL(P.source,(function(A,B){return function(E){u.loaded++;var D=null;var C=new fabric.StaticCanvas(undefined,{backgroundColor:A.fill});C.add(E);D=new fabric.Pattern({source:function(){C.setDimensions({width:A.width,height:A.height});return C.getElement()},repeat:"repeat"});l.paths[B].set({fill:D,opacity:l.paths[B].fillOpacity})}})(P,O))}}}if(U=f.isHashbanged(l.paths[O].clipPath)){if(g.clippings&&g.clippings[U]){l.paths[O].set({clipTo:(function(A,B){return function(E){var C=g.clippings[B];var F=this.transformMatrix||[1,0,0,1,0,0];var D={top:(C.bbox.y-F[5])+C.transform[5],left:(C.bbox.x-F[4])+C.transform[4],width:C.bbox.width,height:C.bbox.height};E.rect(D.left,D.top,D.width,D.height)}})(O,U)})}}if(l.paths[O].TSPANWORKAROUND){var T=fabric.parseAttributes(l.paths[O].svg,fabric.Text.ATTRIBUTE_NAMES);var N=fabric.util.object.extend({},T);var i=[];for(var L=0;L<l.paths[O].svg.childNodes.length;L++){var V=l.paths[O].svg.childNodes[L];var j=fabric.Text.fromElement(V,N);j.set({left:0});i.push(j)}l.paths[O].set({opacity:0});var n=new fabric.Group(i,{top:l.paths[O].top*-1});f.setup.fabric.add(n)}}S.push(l.paths[O])}l.paths=S;l.set(h);f.setup.fabric.add(l);if(g.svg.parentNode&&g.svg.parentNode.getElementsByTagName){var o=g.svg.parentNode.getElementsByClassName(f.setup.chart.classNamePrefix+"-balloon-div");for(O=0;O<o.length;O++){if(v.balloonFunction instanceof Function){v.balloonFunction.apply(f,[o[O],g])}else{var m=o[O];var k=fabric.parseStyleAttribute(m);var M=fabric.parseStyleAttribute(m.childNodes[0]);var Q=new fabric.Text(m.innerText||m.innerHTML,{selectable:false,top:k.top+g.offset.y,left:k.left+g.offset.x,fill:M.color,fontSize:M.fontSize,fontFamily:M.fontFamily,textAlign:M["text-align"]});f.setup.fabric.add(Q)}}}if(g.svg.nextSibling&&g.svg.nextSibling.tagName=="A"){var m=g.svg.nextSibling;var k=fabric.parseStyleAttribute(m);var Q=new fabric.Text(m.innerText||m.innerHTML,{selectable:false,top:k.top+g.offset.y,left:k.left+g.offset.x,fill:k.color,fontSize:k.fontSize,fontFamily:k.fontFamily,opacity:k.opacity});f.setup.fabric.add(Q)}z.pop();if(!z.length){var p=setInterval(function(){if(u.loaded==u.included){clearTimeout(p);f.handleCallback(v.afterCapture,v);f.setup.fabric.renderAll();f.handleCallback(c,v)}},AmCharts.updateRate)}}})(q),function(o,p){var B;var j=f.gatherAttribute(o,"class");var h=f.gatherAttribute(o,"visibility");var k=f.gatherAttribute(o,"clip-path");p.className=String(j);p.classList=String(j).split(" ");p.clipPath=k;p.svg=o;if(o.tagName=="text"&&o.childNodes.length>1){p.TSPANWORKAROUND=true}if(h=="hidden"){p.opacity=0}else{var i=["fill","stroke"];for(B=0;B<i.length;B++){var l=i[B];var m=String(o.getAttribute(l)||"");var g=Number(o.getAttribute(l+"-opacity")||"1");var n=fabric.Color.fromHex(m).getSource();if(p.classList.indexOf(f.setup.chart.classNamePrefix+"-guide-fill")!=-1&&!m){g=0;n=fabric.Color.fromHex("#000000").getSource()}if(n){n.pop();n.push(g);p[l]="rgba("+n.join()+")";p[l+f.capitalize("opacity")]=g}}}f.handleCallback(v.reviver,p,o)})}},toCanvas:function(c,a){var h=f.deepMerge({},c||{});var b=f.setup.canvas;f.handleCallback(a,b);return b},toImage:function(c,a){var j=f.deepMerge({format:"png",quality:1,multiplier:1},c||{});var b=j.data;var i=document.createElement("img");if(!j.data){if(j.lossless||j.format=="svg"){b=f.toSVG(f.deepMerge(j,{getBase64:true}))}else{b=f.setup.fabric.toDataURL(j)}}i.setAttribute("src",b);f.handleCallback(a,i);return i},toBlob:function(i,a){var j=f.deepMerge({data:"empty",type:"text/plain"},i||{});var c;var b=/^data:.+;base64,(.*)$/.exec(j.data);if(b){j.data=b[0];j.type=j.data.slice(5,j.data.indexOf(",")-7);j.data=f.toByteArray({data:j.data.slice(j.data.indexOf(",")+1,j.data.length)})}if(j.getByteArray){c=j.data}else{c=new Blob([j.data],{type:j.type})}f.handleCallback(a,c);return c},toJPG:function(c,a){var h=f.deepMerge({format:"jpeg",quality:1,multiplier:1},c||{});h.format=h.format.toLowerCase();var b=f.setup.fabric.toDataURL(h);f.handleCallback(a,b);return b},toPNG:function(c,a){var h=f.deepMerge({format:"png",quality:1,multiplier:1},c||{});var b=f.setup.fabric.toDataURL(h);f.handleCallback(a,b);return b},toSVG:function(c,a){var h=f.deepMerge({reviver:function(u){var v=new RegExp(/\bstyle=(['"])(.*?)\1/);var w=v.exec(u)[0].slice(7,-1);var g=w.split(";");var z=[];for(i1=0;i1<g.length;i1++){if(g[i1]){var x=g[i1].replace(/\s/g,"").split(":");var r=x[0];var s=x[1];if(["fill","stroke"].indexOf(r)!=-1){s=fabric.Color.fromRgba(s);if(s&&s._source){var y="#"+s.toHex();var t=s._source[3];z.push([r,y].join(":"));z.push([r+"-opacity",t].join(":"))}else{z.push(g[i1])}}else{if(r!="opactiy"){z.push(g[i1])}}}}return u.replace(w,z.join(";"))}},c||{});var b=f.setup.fabric.toSVG(h,h.reviver);if(h.getBase64){b="data:image/svg+xml;base64,"+btoa(b)}f.handleCallback(a,b);return b},toPDF:function(c,a){var h=f.deepMerge(f.deepMerge({multiplier:2},f.config.pdfMake),c||{},true);h.images.reference=f.toPNG(h);var b=new pdfMake.createPdf(h);if(a){b.getDataUrl((function(g){return function(){g.apply(f,arguments)}})(a))}return b},toPRINT:function(k,a){var c;var n=f.deepMerge({delay:1,lossless:false},k||{});var b=f.toImage(n);var l=[];var m=document.body.childNodes;b.setAttribute("style","width: 100%; max-height: 100%;");for(c=0;c<m.length;c++){if(f.isElement(m[c])){l[c]=m[c].style.display;m[c].style.display="none"}}document.body.appendChild(b);window.print();setTimeout(function(){for(c=0;c<m.length;c++){if(f.isElement(m[c])){m[c].style.display=l[c]}}document.body.removeChild(b);f.handleCallback(a,b)},n.delay);return b},toJSON:function(c,a){var h=f.deepMerge({dateFormat:f.config.dateFormat||"dateObject",},c||{},true);h.data=h.data?h.data:f.getChartData(h);var b=JSON.stringify(h.data,undefined,"\t");f.handleCallback(a,b);return b},toCSV:function(a,c){var b,v;var r=f.deepMerge({data:f.getChartData(a),delimiter:",",quotes:true,escape:true,withHeader:true},a||{},true);var s="";var p=[];var t=[];function q(g,h){if(typeof g==="string"){if(r.escape){g=g.replace('"','""')}if(r.quotes){g=['"',g,'"'].join("")}}return g}for(o in r.data[0]){t.push(q(o));p.push(o)}if(r.withHeader){s+=t.join(r.delimiter)+"\n"}for(b in r.data){t=[];if(!isNaN(b)){for(v in p){if(!isNaN(v)){var u=p[v];var o=r.data[b][u];t.push(q(o,u))}}s+=t.join(r.delimiter)+"\n"}}f.handleCallback(c,s);return s},toXLSX:function(k,a){var l=f.deepMerge({name:"amCharts",dateFormat:f.config.dateFormat||"dateObject",withHeader:true,stringify:false},k||{},true);var b="";var c={SheetNames:[],Sheets:{}};l.data=l.data?l.data:f.getChartData(l);function n(h,i){if(i){h+=1462}var g=Date.parse(h);return(g-new Date(Date.UTC(1899,11,30)))/(24*60*60*1000)}function m(s,t){var h={};var g={s:{c:10000000,r:10000000},e:{c:0,r:0}};for(var u=0;u!=s.length;++u){for(var j=0;j!=s[u].length;++j){if(g.s.r>u){g.s.r=u}if(g.s.c>j){g.s.c=j}if(g.e.r<u){g.e.r=u}if(g.e.c<j){g.e.c=j}var i={v:s[u][j]};if(i.v==null){continue}var v=XLSX.utils.encode_cell({c:j,r:u});if(typeof i.v==="number"){i.t="n"}else{if(typeof i.v==="boolean"){i.t="b"}else{if(i.v instanceof Date){i.t="n";i.z=XLSX.SSF._table[14];i.v=n(i.v)}else{i.t="s"}}}h[v]=i}}if(g.s.c<10000000){h["!ref"]=XLSX.utils.encode_range(g)}return h}c.SheetNames.push(l.name);c.Sheets[l.name]=m(f.toArray(l));b=XLSX.write(c,{bookType:"xlsx",bookSST:true,type:"base64"});b="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"+b;f.handleCallback(a,b);return b},toArray:function(a,c){var b,r;var o=f.deepMerge({data:f.getChartData(a),withHeader:false,stringify:true},a||{},true);var p=[];var n=[];for(r in o.data[0]){n.push(r)}if(o.withHeader){p.push(n)}for(b in o.data){var q=[];if(!isNaN(b)){for(r in n){if(!isNaN(r)){var r=n[r];var m=o.data[b][r];if(m==null){m=""}else{if(o.stringify){m=String(m)}else{m=m}}q.push(m)}}p.push(q)}}f.handleCallback(c,p);return p},toByteArray:function(a,b){var c=f.deepMerge({},a||{});var q=(typeof Uint8Array!=="undefined")?Uint8Array:Array;var r="+".charCodeAt(0);var w="/".charCodeAt(0);var u="0".charCodeAt(0);var v="a".charCodeAt(0);var p="A".charCodeAt(0);var s=t(c.data);function x(h){var g=h.charCodeAt(0);if(g===r){return 62}if(g===w){return 63}if(g<u){return -1}if(g<u+10){return g-u+26+26}if(g<p+26){return g-p}if(g<v+26){return g-v+26}}function t(i){var o,z,h,n,g,m;if(i.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var l=i.length;g="="===i.charAt(l-2)?2:"="===i.charAt(l-1)?1:0;m=new q(i.length*3/4-g);h=g>0?i.length-4:i.length;var j=0;function k(y){m[j++]=y}for(o=0,z=0;o<h;o+=4,z+=3){n=(x(i.charAt(o))<<18)|(x(i.charAt(o+1))<<12)|(x(i.charAt(o+2))<<6)|x(i.charAt(o+3));k((n&16711680)>>16);k((n&65280)>>8);k(n&255)}if(g===2){n=(x(i.charAt(o))<<2)|(x(i.charAt(o+1))>>4);k(n&255)}else{if(g===1){n=(x(i.charAt(o))<<10)|(x(i.charAt(o+1))<<4)|(x(i.charAt(o+2))>>2);k((n>>8)&255);k(n&255)}}return m}f.handleCallback(b,s);return s},handleCallback:function(a){var c,b=Array();if(a&&a instanceof Function){for(c=0;c<arguments.length;c++){if(c>0){b.push(arguments[c])}}a.apply(f,b)}},handleDropbox:function(a){if(f.drawing.buffer.enabled){a.preventDefault();a.stopPropagation();if(a.type=="dragover"){f.setup.wrapper.setAttribute("class",f.setup.chart.classNamePrefix+"-export-canvas active dropbox")}else{f.setup.wrapper.setAttribute("class",f.setup.chart.classNamePrefix+"-export-canvas active");if(a.type=="drop"&&a.dataTransfer.files.length){for(var b=0;b<a.dataTransfer.files.length;b++){var c=new FileReader();c.onloadend=(function(g){return function(){f.drawing.handler.add({url:c.result,top:a.layerY-(g*10),left:a.layerX-(g*10)})}})(b);c.readAsDataURL(a.dataTransfer.files[b])}}}}},getChartData:function(F){var v=f.deepMerge({data:[],titles:{},dateFields:[],dataFields:[],dataFieldsMap:{},exportTitles:f.config.exportTitles,exportFields:f.config.exportFields,exportSelection:f.config.exportSelection,columnNames:f.config.columnNames},F||{},true);var w,y,z,A;var c=["valueField","openField","closeField","highField","lowField","xField","yField"];function C(h,g,i){function j(l,k){if(v.dataFields.indexOf(l)!=-1){return j([l,".",k].join(""))}return l}if(h&&v.exportTitles&&f.setup.chart.type!="gantt"){w=j(h,i);v.dataFieldsMap[w]=h;v.dataFields.push(w);v.titles[w]=g||w}}if(v.data.length==0){if(f.setup.chart.type=="stock"){v.data=f.setup.chart.mainDataSet.dataProvider;C(f.setup.chart.mainDataSet.categoryField);v.dateFields.push(f.setup.chart.mainDataSet.categoryField);for(y=0;y<f.setup.chart.mainDataSet.fieldMappings.length;y++){var B=f.setup.chart.mainDataSet.fieldMappings[y];for(z=0;z<f.setup.chart.panels.length;z++){var D=f.setup.chart.panels[z];for(A=0;A<D.stockGraphs.length;A++){var b=D.stockGraphs[A];for(i4=0;i4<c.length;i4++){if(b[c[i4]]==B.toField){C(B.fromField,b.title,c[i4])}}}}}for(y=0;y<f.setup.chart.comparedGraphs.length;y++){var b=f.setup.chart.comparedGraphs[y];for(z=0;z<b.dataSet.dataProvider.length;z++){for(A=0;A<b.dataSet.fieldMappings.length;A++){var B=b.dataSet.fieldMappings[A];var w=b.dataSet.id+"_"+B.toField;if(z<v.data.length){v.data[z][w]=b.dataSet.dataProvider[z][B.fromField];if(!v.titles[w]){C(w,b.dataSet.title)}}}}}}else{if(f.setup.chart.type=="gantt"){C(f.setup.chart.categoryField);v.dateFields.push(f.setup.chart.categoryField);var t=f.setup.chart.segmentsField;for(y=0;y<f.setup.chart.dataProvider.length;y++){var E=f.setup.chart.dataProvider[y];if(E[t]){for(z=0;z<E[t].length;z++){E[t][z][f.setup.chart.categoryField]=E[f.setup.chart.categoryField];v.data.push(E[t][z])}}}for(y=0;y<f.setup.chart.graphs.length;y++){var b=f.setup.chart.graphs[y];for(z=0;z<c.length;z++){var a=c[z];var x=b[a];var u=b.title;C(x,b.title,a)}}}else{if(["pie","funnel"].indexOf(f.setup.chart.type)!=-1){v.data=f.setup.chart.dataProvider;C(f.setup.chart.titleField);v.dateFields.push(f.setup.chart.titleField);C(f.setup.chart.valueField)}else{if(f.setup.chart.type!="map"){v.data=f.setup.chart.dataProvider;if(f.setup.chart.categoryAxis){C(f.setup.chart.categoryField,f.setup.chart.categoryAxis.title);if(f.setup.chart.categoryAxis.parseDates!==false){v.dateFields.push(f.setup.chart.categoryField)}}for(y=0;y<f.setup.chart.graphs.length;y++){var b=f.setup.chart.graphs[y];for(z=0;z<c.length;z++){var a=c[z];var x=b[a];C(x,b.title,a)}}}}}}}return f.processData(v)},processData:function(a){var r=f.deepMerge({data:[],titles:{},dateFields:[],dataFields:[],dataFieldsMap:{},dataDateFormat:f.setup.chart.dataDateFormat,dateFormat:f.config.dateFormat||f.setup.chart.dataDateFormat||"YYYY-MM-DD",exportTitles:f.config.exportTitles,exportFields:f.config.exportFields,exportSelection:f.config.exportSelection,columnNames:f.config.columnNames},a||{},true);var u,v;if(r.data.length){for(u=0;u<r.data.length;u++){for(v in r.data[u]){if(r.dataFields.indexOf(v)==-1){r.dataFields.push(v);r.dataFieldsMap[v]=v}}}if(r.exportFields!==undefined){r.dataFields=r.dataFields.filter(function(g){return r.exportFields.indexOf(g)!=-1})}var t=[];for(u=0;u<r.data.length;u++){var s={};var c=false;for(v=0;v<r.dataFields.length;v++){var o=r.dataFields[v];var b=r.dataFieldsMap[o];var q=(r.columnNames&&r.columnNames[o])||r.titles[o]||o;var p=r.data[u][b];if(p==null){p=undefined}if(r.exportTitles&&f.setup.chart.type!="gantt"){if(q in s){q+=["( ",o," )"].join("")}}if(r.dateFields.indexOf(b)!=-1){if(r.dataDateFormat&&(p instanceof String||typeof p=="string")){p=AmCharts.stringToDate(p,r.dataDateFormat)}else{if(r.dateFormat&&(p instanceof Number||typeof p=="number")){p=new Date(p)}}if(r.exportSelection){if(p instanceof Date){if(p<d.startDate||p>d.endDate){c=true}}else{if(u<d.startIndex||u>d.endIndex){c=true}}}if(r.dateFormat&&r.dateFormat!="dateObject"&&p instanceof Date){p=AmCharts.formatDate(p,r.dateFormat)}}s[q]=p}if(!c){t.push(s)}}r.data=t}return r.data},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},createMenu:function(b,h){var a;function c(z,F){var C,E,y=document.createElement("ul");for(C=0;C<z.length;C++){var H=typeof z[C]==="string"?{format:z[C]}:z[C];var I=document.createElement("li");var K=document.createElement("a");var A=document.createElement("img");var J=document.createElement("span");var D=String(H.action?H.action:H.format).toLowerCase();H.format=String(H.format).toUpperCase();if(f.config.formats[H.format]){H=f.deepMerge({label:H.icon?"":H.format,format:H.format,mimeType:f.config.formats[H.format].mimeType,extension:f.config.formats[H.format].extension,capture:f.config.formats[H.format].capture,action:f.config.action,fileName:f.config.fileName},H)}else{if(!H.label){H.label=H.label?H.label:f.i18l("menu.label."+D)}}if(["CSV","JSON","XLSX"].indexOf(H.format)!=-1&&["map","gauge"].indexOf(f.setup.chart.type)!=-1){continue}else{if(!f.setup.hasBlob&&H.format!="UNDEFINED"){if(H.mimeType&&H.mimeType.split("/")[0]!="image"&&H.mimeType!="text/plain"){continue}}}if(H.action=="draw"){if(f.config.fabric.drawing.enabled){H.menu=H.menu?H.menu:f.config.fabric.drawing.menu;H.click=(function(i){return function(){this.capture(i,function(){this.createMenu(i.menu)})}})(H)}else{H.menu=[]}}else{if(!H.populated&&H.action&&H.action.indexOf("draw.")!=-1){var L=H.action.split(".")[1];var g=H[L]||f.config.fabric.drawing[L]||[];H.menu=[];H.populated=true;for(E=0;E<g.length;E++){var B={label:g[E]};if(L=="shapes"){var x=g[E].indexOf("//")==-1;var G=(x?f.config.path+"shapes/":"")+g[E];B.action="add";B.url=G;B.icon=G;B.ignore=x;B["class"]="export-drawing-shape"}else{if(L=="colors"){B.style="background-color: "+g[E];B.action="change";B.color=g[E];B["class"]="export-drawing-color"}else{if(L=="widths"){B.action="change";B.width=g[E];B.label=document.createElement("span");B.label.style.width=f.numberToPx(g[E]);B.label.style.height=f.numberToPx(g[E]);B["class"]="export-drawing-width"}else{if(L=="opacities"){B.style="opacity: "+g[E];B.action="change";B.opacity=g[E];B.label=(g[E]*100)+"%";B["class"]="export-drawing-opacity"}else{if(L=="modes"){B.label=f.i18l("menu.label.draw.modes."+g[E]);B.click=(function(i){return function(){f.drawing.mode=i}})(g[E]);B["class"]="export-drawing-mode"}}}}}H.menu.push(B)}}else{if(!H.click&&!H.menu&&!H.items){if(f.drawing.handler[D] instanceof Function){H.action=D;H.click=(function(i){return function(){this.drawing.handler[i.action](i)}})(H)}else{if(f.drawing.buffer.enabled){H.click=(function(i){return function(){if(this.config.drawing.autoClose){this.drawing.handler.done()}this["to"+i.format](i,function(j){if(i.action=="download"){this.download(j,i.mimeType,[i.fileName,i.extension].join("."))}})}})(H)}else{if(H.format!="UNDEFINED"){H.click=(function(i){return function(){if(i.capture||i.action=="print"||i.format=="PRINT"){this.capture(i,function(){if(this.config.drawing.autoClose){this.drawing.handler.done()}this["to"+i.format](i,function(j){if(i.action=="download"){this.download(j,i.mimeType,[i.fileName,i.extension].join("."))}})})}else{if(this["to"+i.format]){this["to"+i.format](i,function(j){this.download(j,i.mimeType,[i.fileName,i.extension].join("."))})}else{throw new Error("Invalid format. Could not determine output type.")}}}})(H)}}}}}}if(H.menu!==undefined&&!H.menu.length){continue}K.setAttribute("href","#");K.addEventListener("click",(function(j,i){return function(k){k.preventDefault();var l=[k,i];if((i.action=="draw"||i.format=="PRINT"||(i.format!="UNDEFINED"&&i.capture))&&!f.drawing.enabled){i.delay=i.delay?i.delay:f.config.delay;if(i.delay){f.delay(i,j);return}}j.apply(f,l)}})(H.click||function(i){i.preventDefault()},H));I.appendChild(K);if(f.isElement(H.label)){J.appendChild(H.label)}else{J.innerHTML=H.label}if(H["class"]){I.className=H["class"]}if(H.style){I.setAttribute("style",H.style)}if(H.icon){A.setAttribute("src",(!H.ignore&&H.icon.slice(0,10).indexOf("//")==-1?d.pathToImages:"")+H.icon);K.appendChild(A)}if(H.label){K.appendChild(J)}if(H.title){K.setAttribute("title",H.title)}if(f.config.menuReviver){I=f.config.menuReviver.apply(f,[H,I])}H.elements={li:I,a:K,img:A,span:J};if((H.menu||H.items)&&H.action!="draw"){if(c(H.menu||H.items,I).childNodes.length){y.appendChild(I)}}else{y.appendChild(I)}}if(y.childNodes.length){F.appendChild(y)}return y}if(!h){if(typeof f.config.divId=="string"){f.config.divId=h=document.getElementById(f.config.divId)}else{if(f.isElement(f.config.divId)){h=f.config.divId}else{h=f.setup.chart.containerDiv}}}if(f.isElement(f.setup.menu)){f.setup.menu.innerHTML=""}else{f.setup.menu=document.createElement("div")}f.setup.menu.setAttribute("class",f.setup.chart.classNamePrefix+"-export-menu "+f.setup.chart.classNamePrefix+"-export-menu-"+f.config.position+" amExportButton");if(f.config.menuWalker){c=f.config.menuWalker}c.apply(this,[b,f.setup.menu]);if(f.setup.menu.childNodes.length){h.appendChild(f.setup.menu)}return f.setup.menu},delay:function(n,a){var p=f.deepMerge({delay:3,precision:2},n||{});var l,m,b=Number(new Date());var c=f.createMenu([{label:f.i18l("capturing.delayed.menu.label").replace("{{duration}}",AmCharts.toFixed(p.delay,p.precision)),title:f.i18l("capturing.delayed.menu.title"),"class":"export-delayed-capturing",click:function(){clearTimeout(l);clearTimeout(m);f.createMenu(f.config.menu)}}]);var o=c.getElementsByTagName("a")[0];l=setInterval(function(){var g=p.delay-(Number(new Date())-b)/1000;if(g<=0){clearTimeout(l);if(p.action!="draw"){f.createMenu(f.config.menu)}}else{if(o){o.innerHTML=f.i18l("capturing.delayed.menu.label").replace("{{duration}}",AmCharts.toFixed(g,2))}}},10);m=setTimeout(function(){a.apply(f,arguments)},p.delay*1000)},migrateSetup:function(c){var b={enabled:true,migrated:true,libs:{autoLoad:true},menu:[]};function a(l){var k;for(k in l){var j=l[k];if(k.slice(0,6)=="export"&&j){b.menu.push(k.slice(6))}else{if(k=="userCFG"){a(j)}else{if(k=="menuItems"){b.menu=j}else{if(k=="libs"){b.libs=j}else{if(typeof k=="string"){b[k]=j}}}}}}}a(c);return b},loadListeners:function(){function a(b){if(b){b.set({top:b.top+10,left:b.left+10});f.setup.fabric.add(b)}}if(f.config.keyListener&&f.config.keyListener!="attached"){f.config.keyListener="attached";document.addEventListener("keydown",function(b){var c=f.drawing.buffer.target;if((b.keyCode==8||b.keyCode==46)&&c){b.preventDefault();f.setup.fabric.remove(c)}else{if(b.keyCode==27&&f.drawing.enabled){b.preventDefault();f.drawing.handler.done()}else{if(b.keyCode==67&&(b.metaKey||b.ctrlKey)&&c){f.drawing.buffer.copy=c}else{if(b.keyCode==88&&(b.metaKey||b.ctrlKey)&&c){f.drawing.buffer.copy=c;f.setup.fabric.remove(c)}else{if(b.keyCode==86&&(b.metaKey||b.ctrlKey)){if(f.drawing.buffer.copy){a(f.drawing.buffer.copy.clone(a))}}else{if(b.keyCode==90&&(b.metaKey||b.ctrlKey)){b.preventDefault();if(b.shiftKey){f.drawing.handler.redo()}else{f.drawing.handler.undo()}}}}}}}})}if(f.config.fileListener){f.setup.chart.containerDiv.addEventListener("dragover",f.handleDropbox);f.setup.chart.containerDiv.addEventListener("dragleave",f.handleDropbox);f.setup.chart.containerDiv.addEventListener("drop",f.handleDropbox)}},init:function(){clearTimeout(f.timer);f.timer=setInterval(function(){if(f.setup.chart.containerDiv){clearTimeout(f.timer);if(f.config.enabled){f.setup.chart.AmExport=f;if(f.config.overflow){f.setup.chart.div.style.overflow="visible"}f.loadListeners();f.createMenu(f.config.menu)}}},AmCharts.updateRate)},construct:function(){f.drawing.handler.cancel=f.drawing.handler.done;try{f.setup.hasBlob=!!new Blob}catch(a){}window.safari=window.safari?window.safari:{};f.defaults.fabric.drawing.fontSize=f.setup.chart.fontSize||11;f.config.drawing=f.deepMerge(f.defaults.fabric.drawing,f.config.drawing||{},true);f.deepMerge(f.defaults.fabric,f.config,true);f.deepMerge(f.defaults.fabric,f.config.fabric||{},true);f.deepMerge(f.defaults.pdfMake,f.config,true);f.deepMerge(f.defaults.pdfMake,f.config.pdfMake||{},true);f.deepMerge(f.libs,f.config.libs||{},true);f.config.drawing=f.defaults.fabric.drawing;f.config.fabric=f.defaults.fabric;f.config.pdfMake=f.defaults.pdfMake;f.config=f.deepMerge(f.defaults,f.config,true);if(f.config.fabric.drawing.enabled){if(f.config.fabric.drawing.menu===undefined){f.config.fabric.drawing.menu=[];f.deepMerge(f.config.fabric.drawing.menu,[{"class":"export-drawing",menu:[{label:f.i18l("menu.label.draw.add"),menu:[{label:f.i18l("menu.label.draw.shapes"),action:"draw.shapes"},{label:f.i18l("menu.label.draw.text"),action:"text"}]},{label:f.i18l("menu.label.draw.change"),menu:[{label:f.i18l("menu.label.draw.modes"),action:"draw.modes"},{label:f.i18l("menu.label.draw.colors"),action:"draw.colors"},{label:f.i18l("menu.label.draw.widths"),action:"draw.widths"},{label:f.i18l("menu.label.draw.opacities"),action:"draw.opacities"},"UNDO","REDO"]},{label:f.i18l("menu.label.save.image"),menu:["PNG","JPG","SVG","PDF"]},"PRINT","CANCEL"]}])}}if(f.config.menu===undefined){f.config.menu=[];f.deepMerge(f.config,{menu:[{"class":"export-main",menu:[{label:f.i18l("menu.label.save.image"),menu:["PNG","JPG","SVG","PDF"]},{label:f.i18l("menu.label.save.data"),menu:["CSV","XLSX","JSON"]},{label:f.i18l("menu.label.draw"),action:"draw",menu:f.config.fabric.drawing.menu},{format:"PRINT",label:f.i18l("menu.label.print")}]}]})}if(!f.libs.path){f.libs.path=f.config.path+"libs/"}if(f.isSupported()){f.loadDependencies(f.libs.resources,f.libs.reload);f.setup.chart.addClassNames=true;f.setup.chart[f.name]=f;f.init()}}};if(e){f.config=e}else{if(f.setup.chart[f.name]){f.config=f.setup.chart[f.name]}else{if(f.setup.chart.amExport||f.setup.chart.exportConfig){f.config=f.migrateSetup(f.setup.chart.amExport||f.setup.chart.exportConfig)}else{return}}}f.construct();return f.deepMerge(this,f)}})();AmCharts.addInitHandler(function(b){new AmCharts["export"](b)},["pie","serial","xy","funnel","radar","gauge","stock","map","gantt"]);